<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>çˆ†é‡è‚¡ç¥¨æŸ¥è©¢</title>
</head>
<body>
    <h1>ğŸ“ˆ çˆ†é‡è‚¡ç¥¨æŸ¥è©¢ç³»çµ±</h1>

    <form method="get">
        <label>è‚¡ç¥¨ä»£è™Ÿï¼š</label>
        <select name="stock_id">
            <option value="">å…¨éƒ¨</option>
            {% for sid in stock_ids %}
            <option value="{{ sid }}" {% if sid == stock_id %}selected{% endif %}>{{ sid }}</option>
            {% endfor %}
        </select>

        <label>é–‹å§‹æ—¥æœŸï¼š</label>
        <input type="date" name="start_date" value="{{ start_date }}">

        <label>çµæŸæ—¥æœŸï¼š</label>
        <input type="date" name="end_date" value="{{ end_date }}">
        <br>
        <label>
            <input type="checkbox" name="spike_only" value="true" {% if spike_only %}checked{% endif %}>
            åªé¡¯ç¤ºçˆ†é‡
        </label>
        <label>
            <input type="checkbox" name="up_only" value="true" {% if up_only %}checked{% endif %}>
            åªé¡¯ç¤ºæ”¶ç´…ï¼ˆæ”¶ç›¤ > é–‹ç›¤ï¼‰
        </label>

        <button type="submit">æŸ¥è©¢</button>
    </form>

    <div>
        ğŸ“Š ç¸½ç­†æ•¸ï¼š{{ stocks|length }}ã€€
        ğŸš¨ çˆ†é‡ï¼š{{ spike_count }}ã€€
        âœ… æ­£å¸¸ï¼š{{ normal_count }}
    </div>
    {% if valuation %}
    <hr>
    <h2>ğŸ’° åˆç†åƒ¹è¨ˆç®—ï¼ˆ{{ valuation.stock_id }}ï¼‰</h2>
    <p>æœ€æ–° EPSï¼š{{ valuation.eps }}</p>
    <ul>
        <li>ä¾¿å®œåƒ¹ï¼ˆPE=10ï¼‰ï¼š<strong>{{ valuation.cheap_price }}</strong></li>
        <li>åˆç†åƒ¹ï¼ˆPE=15ï¼‰ï¼š<strong>{{ valuation.fair_price }}</strong></li>
        <li>æ˜‚è²´åƒ¹ï¼ˆPE=20ï¼‰ï¼š<strong>{{ valuation.expensive_price }}</strong></li>
    </ul>
    {% endif %}
    

    <table border="1" style="margin-top: 20px;">
        <thead>
            <tr><th>ä»£è™Ÿ</th><th>åç¨±</th><th>æ—¥æœŸ</th><th>é–‹ç›¤åƒ¹</th><th>æ”¶ç›¤åƒ¹</th><th>ä»Šæ—¥é‡</th><th>5æ—¥å‡é‡</th><th>ç‹€æ…‹</th><th>æ¼²è·Œ</th></tr>
        </thead>
        <tbody>
        {% for row in stocks %}
            <tr style="background-color: {{ 'pink' if row.is_spike else '#ecfff1' }}">
                <td>{{ row.stock_id }}</td>
                <td>{{ row.stock_name }}</td>
                <td>{{ row.date }}</td>
                <td>{{ row.open_price }}</td>
                <td>{{ row.close_price }}</td>
                <td>{{ row.today_volume }}</td>
                <td>{{ row.avg_volume_5 }}</td>
                <td>{{ 'ğŸš¨ çˆ†é‡' if row.is_spike else 'âœ… æ­£å¸¸' }}</td>
                <td>
                    {% if row.close_price is not none and row.open_price is not none %}
                        {{ 'ğŸš¨ æ¼²' if row.close_price > row.open_price else 'âœ… è·Œæˆ–å¹³ç›¤' }}
                    {% else %}
                        â“ è³‡æ–™ä¸è¶³
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</body>
</html>
